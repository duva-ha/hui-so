<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ª•iSmart v3.0 - Qu·∫£n l√Ω & Nh·∫Øc n·ª£ Zalo</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f1f5f9; font-family: 'Inter', sans-serif; }
        .card-shadow { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); }
        .animate-pop { animation: pop 0.3s ease-out; }
        @keyframes pop { 0% { transform: scale(0.95); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function HuiApp() {
            const [huiGroups, setHuiGroups] = useState(() => {
                const saved = localStorage.getItem('hui_v3_data');
                return saved ? JSON.parse(saved) : [];
            });
            const [view, setView] = useState('list');
            const [selectedHui, setSelectedHui] = useState(null);
            const [showModal, setShowModal] = useState(false);
            const [newHui, setNewHui] = useState({ name: '', amount: 5000000, members: 10, commission: 100000 });

            useEffect(() => {
                localStorage.setItem('hui_v3_data', JSON.stringify(huiGroups));
            }, [huiGroups]);

            const addHuiGroup = () => {
                if (!newHui.name) return alert("Vui l√≤ng nh·∫≠p t√™n d√¢y h·ª•i");
                const group = {
                    id: Date.now(),
                    ...newHui,
                    periods: [],
                    createdAt: new Date().toLocaleDateString('vi-VN')
                };
                setHuiGroups([...huiGroups, group]);
                setShowModal(false);
            };

            const handleKhuiHui = (bidAmount) => {
                if (!bidAmount || bidAmount < 0) return alert("Vui l√≤ng nh·∫≠p ti·ªÅn l√£i ƒë·∫•u");
                const updatedGroups = huiGroups.map(g => {
                    if (g.id === selectedHui.id) {
                        const newPeriod = {
                            id: Date.now(),
                            periodNum: g.periods.length + 1,
                            bid: Number(bidAmount),
                            date: new Date().toLocaleDateString('vi-VN')
                        };
                        const updatedHui = { ...g, periods: [newPeriod, ...g.periods] }; // K·ª≥ m·ªõi nh·∫•t l√™n ƒë·∫ßu
                        setSelectedHui(updatedHui);
                        return updatedHui;
                    }
                    return g;
                });
                setHuiGroups(updatedGroups);
                document.getElementById('bidInput').value = '';
            };

            const copyZaloMsg = (p, group) => {
                const livingCount = group.members - p.periodNum;
                const deadCount = p.periodNum - 1;
                const songAmount = group.amount - p.bid;
                const chetAmount = group.amount;
                const received = (livingCount * songAmount) + (deadCount * chetAmount) - group.commission;

                const msg = `üîî TH√îNG B√ÅO H·ªòI: ${group.name.toUpperCase()}
üìÖ K·ª≥ khui: K·ª≥ ${p.periodNum} (${p.date})
-------------------------
üí∞ M·ª©c l√£i ƒë·∫•u: ${p.bid.toLocaleString()}ƒë
‚úÖ H·ª•i s·ªëng (ng∆∞·ªùi ch∆∞a h·ªët): ${songAmount.toLocaleString()}ƒë
üíÄ H·ª•i ch·∫øt (ng∆∞·ªùi ƒë√£ h·ªët): ${chetAmount.toLocaleString()}ƒë
-------------------------
üëâ T·ªïng ti·ªÅn ng∆∞·ªùi h·ªët nh·∫≠n: ${received.toLocaleString()}ƒë
(ƒê√£ tr·ª´ ti·ªÅn c√≤: ${group.commission.toLocaleString()}ƒë)`;
                
                navigator.clipboard.writeText(msg);
                alert("ƒê√£ copy tin nh·∫Øn b√°o h·ª•i! H√£y d√°n v√†o Zalo.");
            };

            return (
                <div className="max-w-4xl mx-auto p-4 md:p-6 mb-10">
                    <header className="flex justify-between items-center mb-8">
                        <div onClick={() => setView('list')} className="cursor-pointer">
                            <h1 className="text-3xl font-black text-blue-600 flex items-center gap-2">
                                <i className="fas fa-wallet text-2xl"></i> H·ª•iSmart
                            </h1>
                        </div>
                        {view === 'list' && (
                            <button onClick={() => setShowModal(true)} className="bg-blue-600 text-white p-3 px-5 rounded-2xl font-bold shadow-lg shadow-blue-200 active:scale-95 transition">
                                + T·∫°o D√¢y M·ªõi
                            </button>
                        )}
                    </header>

                    {view === 'list' ? (
                        <div className="grid gap-4">
                            {huiGroups.length === 0 && <div className="text-center p-20 bg-white rounded-3xl border-2 border-dashed text-gray-400">Ch∆∞a c√≥ d·ªØ li·ªáu d√¢y h·ª•i.</div>}
                            {huiGroups.map(group => (
                                <div key={group.id} className="bg-white p-5 rounded-3xl card-shadow flex justify-between items-center border border-white">
                                    <div>
                                        <h3 className="font-bold text-slate-800 text-lg">{group.name}</h3>
                                        <p className="text-sm text-slate-500">{group.amount.toLocaleString()}ƒë ‚Ä¢ {group.members} ph·∫ßn ‚Ä¢ K·ª≥ {group.periods.length}/{group.members}</p>
                                    </div>
                                    <button onClick={() => { setSelectedHui(group); setView('detail'); }} className="bg-slate-100 p-3 px-5 rounded-xl font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-600 transition">
                                        Chi ti·∫øt
                                    </button>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="animate-pop">
                            <button onClick={() => setView('list')} className="mb-4 text-slate-500 font-medium"><i className="fas fa-arrow-left mr-2"></i> Quay l·∫°i</button>
                            
                            <div className="bg-white p-6 rounded-3xl card-shadow mb-6">
                                <h2 className="text-2xl font-bold text-slate-800 mb-2">{selectedHui.name}</h2>
                                <div className="flex gap-4 text-sm mb-6 text-slate-500">
                                    <span>Gi√° tr·ªã: <b>{selectedHui.amount.toLocaleString()}ƒë</b></span>
                                    <span>T·ªïng: <b>{selectedHui.members} ph·∫ßn</b></span>
                                </div>

                                {selectedHui.periods.length < selectedHui.members && (
                                    <div className="bg-blue-50 p-5 rounded-2xl border border-blue-100 mb-8">
                                        <label className="block text-sm font-bold text-blue-800 mb-2 uppercase">Khui k·ª≥ th·ª© {selectedHui.periods.length + 1}</label>
                                        <div className="flex gap-3">
                                            <input id="bidInput" type="number" placeholder="Nh·∫≠p m·ª©c l√£i ƒë·∫•u..." className="flex-1 p-3 rounded-xl border-none outline-none focus:ring-2 focus:ring-blue-500" />
                                            <button onClick={() => handleKhuiHui(document.getElementById('bidInput').value)} className="bg-blue-600 text-white px-6 rounded-xl font-bold">X√°c nh·∫≠n</button>
                                        </div>
                                    </div>
                                )}

                                <h3 className="font-bold text-slate-700 mb-4">L·ªãch s·ª≠ & B·∫£ng k√™</h3>
                                <div className="space-y-4">
                                    {selectedHui.periods.map(p => {
                                        const livingCount = selectedHui.members - p.periodNum;
                                        const deadCount = p.periodNum - 1;
                                        const songAmt = selectedHui.amount - p.bid;
                                        const received = (livingCount * songAmt) + (deadCount * selectedHui.amount) - selectedHui.commission;
                                        
                                        return (
                                            <div key={p.id} className="border border-slate-100 rounded-2xl overflow-hidden bg-slate-50">
                                                <div className="p-4 flex justify-between items-center bg-white">
                                                    <span className="font-bold">K·ª≥ {p.periodNum} <span className="text-slate-400 font-normal ml-2">{p.date}</span></span>
                                                    <button onClick={() => copyZaloMsg(p, selectedHui)} className="text-green-600 font-bold text-sm bg-green-50 p-2 px-4 rounded-lg"><i className="fab fa-whatsapp"></i> G·ª≠i Zalo</button>
                                                </div>
                                                <div className="p-4 grid grid-cols-2 md:grid-cols-3 gap-3">
                                                    <div className="bg-white p-3 rounded-xl border border-slate-100">
                                                        <span className="text-[10px] text-slate-400 block font-bold uppercase">H·ª•i s·ªëng ({livingCount})</span>
                                                        <span className="font-bold text-blue-600">{songAmt.toLocaleString()}ƒë</span>
                                                    </div>
                                                    <div className="bg-white p-3 rounded-xl border border-slate-100">
                                                        <span className="text-[10px] text-slate-400 block font-bold uppercase">H·ª•i ch·∫øt ({deadCount})</span>
                                                        <span className="font-bold text-red-600">{selectedHui.amount.toLocaleString()}ƒë</span>
                                                    </div>
                                                    <div className="bg-white p-3 rounded-xl border border-slate-100 col-span-2 md:col-span-1">
                                                        <span className="text-[10px] text-slate-400 block font-bold uppercase">Ng∆∞·ªùi h·ªët nh·∫≠n</span>
                                                        <span className="font-bold text-green-600 text-lg">{received.toLocaleString()}ƒë</span>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal T·∫°o D√¢y */}
                    {showModal && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl animate-pop">
                                <h2 className="text-xl font-bold mb-6 text-slate-800">Th√¥ng s·ªë d√¢y h·ª•i</h2>
                                <div className="space-y-4">
                                    <input type="text" placeholder="T√™n d√¢y (V√≠ d·ª•: H·ª•i 5tr C√¥ Ba)" className="w-full p-4 bg-slate-100 rounded-2xl outline-none" onChange={(e)=>setNewHui({...newHui, name: e.target.value})}/>
                                    <input type="number" placeholder="S·ªë ti·ªÅn ƒë√≥ng" className="w-full p-4 bg-slate-100 rounded-2xl outline-none" value={newHui.amount} onChange={(e)=>setNewHui({...newHui, amount: Number(e.target.value)})}/>
                                    <input type="number" placeholder="S·ªë ph·∫ßn" className="w-full p-4 bg-slate-100 rounded-2xl outline-none" value={newHui.members} onChange={(e)=>setNewHui({...newHui, members: Number(e.target.value)})}/>
                                    <input type="number" placeholder="Ti·ªÅn c√≤ ch·ªß h·ª•i" className="w-full p-4 bg-slate-100 rounded-2xl outline-none" value={newHui.commission} onChange={(e)=>setNewHui({...newHui, commission: Number(e.target.value)})}/>
                                    <div className="flex gap-2 pt-4">
                                        <button onClick={()=>setShowModal(false)} className="flex-1 py-4 font-bold text-slate-400">H·ªßy</button>
                                        <button onClick={addHuiGroup} className="flex-1 bg-blue-600 text-white rounded-2xl font-bold shadow-lg shadow-blue-200">B·∫Øt ƒë·∫ßu</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HuiApp />);
    </script>
</body>
</html>
